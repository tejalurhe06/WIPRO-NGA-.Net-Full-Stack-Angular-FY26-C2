@model IEnumerable<LibraryManagementSystem.Core.Models.Author>

@{
    ViewData["Title"] = "Authors";
}

<h1>Authors</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">Create New</a>
</p>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Date of Birth</th>
            <th>Number of Books</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.Name)</td>
                <td>@Html.DisplayFor(modelItem => item.DateOfBirth)</td>
                <td>@(item.Books?.Count ?? 0)</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning">Edit</a>
                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">Details</a>
                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="row mt-4">
    <div class="col-md-6">
        <h3>Quick Author Lookup</h3>
        <div class="form-group">
            <label for="authorLookup" class="control-label">Select Author</label>
            <select id="authorLookup" class="form-control">
                <option value="">Select Author</option>
                @if (Model != null)
                {
                    foreach (var author in Model)
                    {
                        <option value="@author.Id">@author.Name</option>
                    }
                }
            </select>
        </div>
        <div id="authorDetails" class="mt-3 p-3 border rounded" style="display: none;">
            <h4>Author Details</h4>
            <div id="authorInfo"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#authorLookup').change(function () {
                var authorId = $(this).val();
                
                if (!authorId) {
                    $('#authorDetails').hide();
                    return;
                }
                
                $('#authorInfo').html('<p>Loading...</p>');
                $('#authorDetails').show();
                
                $.get('@Url.Action("GetAuthorDetails", "Authors")', { id: authorId }, function (data) {
                    if (data.error) {
                        $('#authorInfo').html('<p class="text-danger">' + data.error + '</p>');
                        return;
                    }
                    
                    var html = '<p><strong>Name:</strong> ' + data.name + '</p>';
                    html += '<p><strong>Date of Birth:</strong> ' + data.dateOfBirth + '</p>';
                    html += '<p><strong>Biography:</strong> ' + data.biography + '</p>';
                    html += '<p><strong>Number of Books:</strong> ' + data.bookCount + '</p>';
                    
                    $('#authorInfo').html(html);
                }).fail(function () {
                    $('#authorInfo').html('<p class="text-danger">Error loading author details.</p>');
                });
            });
        });
    </script>
}